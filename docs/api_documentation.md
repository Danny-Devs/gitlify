# API Documentation

## Overview

This document outlines the REST API endpoints available in the Gitlify application. The API allows clients to analyze GitHub repositories, generate PRDs, and access analysis results without sending code to external services.

## Base URL

```
https://api.gitlify.com/api
```

For local development:

```
http://localhost:3000/api
```

## Authentication

### Authentication Methods

All API requests require authentication using one of the following methods:

1. **API Key**: Include your API key in the `Authorization` header

   ```
   Authorization: Bearer YOUR_API_KEY
   ```

2. **Session Authentication**: For browser-based applications, sessions are automatically managed via cookies

### API Key Management

API keys can be created and managed through the dashboard interface or via dedicated API endpoints.

## Endpoints

### Repositories

#### List Repositories

```http
GET /repositories
```

Returns a list of repositories that the user has analyzed.

**Query Parameters:**

| Parameter | Type   | Description                        |
| --------- | ------ | ---------------------------------- |
| limit     | number | Maximum number of items to return  |
| offset    | number | Number of items to skip            |
| search    | string | Search term to filter repositories |

**Response:**

```json
{
  "repositories": [
    {
      "id": "uuid",
      "url": "https://github.com/owner/repo",
      "name": "repo",
      "owner": "owner",
      "lastAnalyzed": "2023-06-15T10:30:00Z",
      "createdAt": "2023-06-15T10:00:00Z",
      "updatedAt": "2023-06-15T10:30:00Z"
    }
  ]
}
```

#### Get Repository

```http
GET /repositories?url=https://github.com/owner/repo
```

Returns details about a specific repository.

**Response:**

```json
{
  "repository": {
    "id": "uuid",
    "url": "https://github.com/owner/repo",
    "name": "repo",
    "owner": "owner",
    "lastAnalyzed": "2023-06-15T10:30:00Z",
    "lastCommitSha": "a1b2c3d4e5f6g7h8i9j0",
    "createdAt": "2023-06-15T10:00:00Z",
    "updatedAt": "2023-06-15T10:30:00Z"
  }
}
```

#### Add Repository

```http
POST /repositories
```

Adds a new repository for analysis.

**Request Body:**

```json
{
  "name": "repo",
  "owner": "owner",
  "description": "Repository description",
  "url": "https://github.com/owner/repo",
  "isPrivate": false,
  "stars": 100,
  "forks": 50
}
```

**Response:**

```json
{
  "id": "uuid",
  "url": "https://github.com/owner/repo",
  "name": "repo",
  "owner": "owner",
  "description": "Repository description",
  "isPrivate": false,
  "stars": 100,
  "forks": 50,
  "createdAt": "2023-06-15T10:00:00Z",
  "updatedAt": "2023-06-15T10:00:00Z"
}
```

### GitHub API

#### Search Repositories

```http
GET /github?query=react
```

Searches for repositories on GitHub.

**Query Parameters:**

| Parameter | Type   | Description                      |
| --------- | ------ | -------------------------------- |
| query     | string | Search term to find repositories |

**Response:**

```json
{
  "items": [
    {
      "id": 10270250,
      "name": "react",
      "full_name": "facebook/react",
      "owner": {
        "login": "facebook"
      },
      "html_url": "https://github.com/facebook/react",
      "description": "A declarative, efficient, and flexible JavaScript library for building user interfaces.",
      "stargazers_count": 200000,
      "forks_count": 40000
    }
  ],
  "total_count": 100
}
```

#### Get Repository Details

```http
GET /github/repo?owner=facebook&repo=react
```

Gets detailed information about a specific GitHub repository.

**Query Parameters:**

| Parameter | Type   | Description                   |
| --------- | ------ | ----------------------------- |
| owner     | string | Repository owner/organization |
| repo      | string | Repository name               |

**Response:**

```json
{
  "id": 10270250,
  "name": "react",
  "full_name": "facebook/react",
  "owner": {
    "login": "facebook"
  },
  "html_url": "https://github.com/facebook/react",
  "description": "A declarative, efficient, and flexible JavaScript library for building user interfaces.",
  "stargazers_count": 200000,
  "forks_count": 40000,
  "created_at": "2013-05-24T16:15:54Z",
  "updated_at": "2023-06-15T10:00:00Z"
}
```

### PRDs

#### List PRDs

```http
GET /prds
```

Returns a list of PRDs generated by the user.

**Response:**

```json
{
  "prds": [
    {
      "id": "uuid",
      "title": "React - Project Requirements",
      "summary": "Comprehensive analysis of the React library",
      "repositoryId": "uuid",
      "createdAt": "2023-06-15T10:00:00Z",
      "updatedAt": "2023-06-15T10:30:00Z",
      "status": "published"
    }
  ]
}
```

#### Get PRD

```http
GET /prds/:id
```

Returns details about a specific PRD, including chapters and diagrams.

**Response:**

```json
{
  "id": "uuid",
  "title": "React - Project Requirements",
  "summary": "Comprehensive analysis of the React library",
  "repositoryId": "uuid",
  "status": "published",
  "createdAt": "2023-06-15T10:00:00Z",
  "updatedAt": "2023-06-15T10:30:00Z",
  "chapters": [
    {
      "id": "uuid",
      "title": "Introduction and Overview",
      "orderIndex": 0,
      "content": "Markdown content here...",
      "diagrams": [
        {
          "id": "uuid",
          "title": "Component Architecture",
          "type": "component",
          "mermaidCode": "graph TD\nA[Component] --> B[Renderer]\n...",
          "description": "Visualization of React's component architecture"
        }
      ]
    }
  ]
}
```

### LLM Configurations

#### List LLM Configurations

```http
GET /llm/configs
```

Returns a list of LLM configurations for the user.

**Response:**

```json
[
  {
    "id": "uuid",
    "name": "Ollama - CodeLlama 7B",
    "modelName": "codellama:7b",
    "contextWindow": 4096,
    "isActive": true,
    "ownedByUser": true
  }
]
```

#### Create LLM Configuration

```http
POST /llm/configs
```

Creates a new LLM configuration.

**Request Body:**

```json
{
  "name": "LM Studio - WizardCoder",
  "endpoint": "http://localhost:8080/v1",
  "apiKey": "optional-api-key",
  "modelName": "WizardCoder-15B-V1.0",
  "contextWindow": 8192,
  "isActive": true
}
```

**Response:**

```json
{
  "id": "uuid",
  "name": "LM Studio - WizardCoder",
  "endpoint": "http://localhost:8080/v1",
  "modelName": "WizardCoder-15B-V1.0",
  "contextWindow": 8192,
  "isActive": true,
  "createdAt": "2023-06-15T10:00:00Z"
}
```

## Rate Limits

To ensure fair usage, the API has the following rate limits:

- 100 requests per minute for authenticated users
- 1000 requests per day per API key

Exceeding these limits will result in a 429 Too Many Requests response.

## Error Handling

All endpoints return standard HTTP status codes:

- 200: Success
- 400: Bad Request (invalid parameters)
- 401: Unauthorized (missing or invalid authentication)
- 403: Forbidden (insufficient permissions)
- 404: Not Found
- 429: Too Many Requests (rate limit exceeded)
- 500: Internal Server Error

Error responses include a JSON body with details:

```json
{
  "error": "Error message describing the issue"
}
```
